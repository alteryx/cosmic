<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Cosmic::SSH
  
    &mdash; Documentation by YARD 0.7.4
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (S)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../Cosmic.html" title="Cosmic (module)">Cosmic</a></span></span>
     &raquo; 
    <span class="title">SSH</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Cosmic::SSH
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="Plugin.html" title="Cosmic::Plugin (class)">Plugin</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="Plugin.html" title="Cosmic::Plugin (class)">Plugin</a></span></li>
          
            <li class="next">Cosmic::SSH</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/cosmic/ssh.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>A plugin that makes SSH and SCP available to Cosmic scripts, e.g. to perform actions on remote
servers or to transfer files. You&#39;d typically use it in a Cosmic context like so:</p>

<pre class="code"><span class='rubyid_with identifier id'>with</span> <span class='rubyid_ssh identifier id'>ssh</span> <span class='rubyid_do do kw'>do</span>
  <span class='rubyid_exec identifier id'>exec</span> <span class='symbol val'>:host</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_host identifier id'>host</span><span class='comma token'>,</span> <span class='symbol val'>:cmd</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;uname -a&quot;</span>

  <span class='rubyid_first identifier id'>first</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>
  <span class='rubyid_upload identifier id'>upload</span> <span class='symbol val'>:host</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_service identifier id'>service</span><span class='dot token'>.</span><span class='rubyid_host identifier id'>host</span><span class='comma token'>,</span> <span class='symbol val'>:local</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_local identifier id'>local</span><span class='comma token'>,</span> <span class='symbol val'>:remote</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_remote identifier id'>remote</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_ch identifier id'>ch</span><span class='comma token'>,</span> <span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='rubyid_sent identifier id'>sent</span><span class='comma token'>,</span> <span class='rubyid_total identifier id'>total</span><span class='bitor op'>|</span>
    <span class='rubyid_print identifier id'>print</span> <span class='string val'>&quot;\r&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_first identifier id'>first</span>
    <span class='rubyid_print identifier id'>print</span> <span class='dstring node'>&quot;#{name}: #{sent}/#{total}&quot;</span>
    <span class='rubyid_first identifier id'>first</span> <span class='assign token'>=</span> <span class='rubyid_false false kw'>false</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_print identifier id'>print</span> <span class='string val'>&quot;\n&quot;</span>
<span class='rubyid_end end kw'>end</span>
</pre>

<p>By default, the plugin assumes that the locally running ssh agent process is configured to
interact with the remote servers without needing passwords (i.e. by having keys registered).
In this case, it will not need a configuration section unless you want more than one instance
of the plugin (which is not really necessary in this case as the plugin does not maintain state).</p>

<p>Alternatively, you can configure it to use specific ssh keys, which you can either reference
directly in the configuration, or have the plugin fetch them from a specific LDAP path.</p>

<p>Lastly, the plugin can determine username &amp; password using the normal environment
authentication mechanisms, e.g. from the configuration or from LDAP.</p>

<p>Note that this plugin will not actually connect to the remote servers in dry-run mode.
Instead it will only send messages tagged as <code>:ssh</code> and <code>:dryrun</code>.</p>


  </div>
</div>
<div class="tags">
  

</div>

  
  
  
  
  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#config-instance_method" title="#config (instance method)">- (Object) <strong>config</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The plugin&#39;s configuration.</p>
</div></span>
  
</li>

    
  </ul>



  
  
  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#download-instance_method" title="#download (instance method)">- <strong>download</strong>(params) { ... }</a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Downloads a remote file from a remote host.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#exec-instance_method" title="#exec (instance method)">- (String) <strong>exec</strong>(params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Executes a command on a remote host and returns the output (stdin &amp; stderr combined) of the
command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (SSH) <strong>initialize</strong>(environment, name = :ssh) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a new ssh plugin instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#upload-instance_method" title="#upload (instance method)">- <strong>upload</strong>(params) { ... }</a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Transfers a local file to a remote host.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="Plugin.html" title="Cosmic::Plugin (class)">Plugin</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Plugin.html#method_missing-instance_method" title="Cosmic::Plugin#method_missing (method)">#method_missing</a></span>, <span class='object_link'><a href="Plugin.html#notify-instance_method" title="Cosmic::Plugin#notify (method)">#notify</a></span>, <span class='object_link'><a href="Plugin.html#respond_to%3F-instance_method" title="Cosmic::Plugin#respond_to? (method)">#respond_to?</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Cosmic::SSH (class)">SSH</a></span></tt>) <strong>initialize</strong>(environment, name = :ssh) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Creates a new ssh plugin instance.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>environment</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Environment.html" title="Cosmic::Environment (class)">Environment</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The Cosmic environment</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>:ssh</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The name for this plugin instance e.g. in the config</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47
48
49
50
51
52
53
54
55
56
57</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cosmic/ssh.rb', line 45</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='rubyid_environment identifier id'>environment</span><span class='comma token'>,</span> <span class='rubyid_name identifier id'>name</span> <span class='assign token'>=</span> <span class='symbol val'>:ssh</span><span class='rparen token'>)</span>
  <span class='rubyid_@environment ivar id'>@environment</span> <span class='assign token'>=</span> <span class='rubyid_environment identifier id'>environment</span>
  <span class='rubyid_@config ivar id'>@config</span> <span class='assign token'>=</span> <span class='rubyid_@environment ivar id'>@environment</span><span class='dot token'>.</span><span class='rubyid_get_plugin_config identifier id'>get_plugin_config</span><span class='lparen token'>(</span><span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_name identifier id'>name</span><span class='dot token'>.</span><span class='rubyid_to_sym identifier id'>to_sym</span><span class='rparen token'>)</span>
  <span class='rubyid_@environment ivar id'>@environment</span><span class='dot token'>.</span><span class='rubyid_resolve_service_auth identifier id'>resolve_service_auth</span><span class='lparen token'>(</span><span class='symbol val'>:service_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_name identifier id'>name</span><span class='dot token'>.</span><span class='rubyid_to_sym identifier id'>to_sym</span><span class='comma token'>,</span> <span class='symbol val'>:config</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@config ivar id'>@config</span><span class='rparen token'>)</span>
  <span class='rubyid_@ssh_opts ivar id'>@ssh_opts</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_@config ivar id'>@config</span><span class='lbrack token'>[</span><span class='symbol val'>:auth</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:keys</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_@config ivar id'>@config</span><span class='lbrack token'>[</span><span class='symbol val'>:auth</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:key_data</span><span class='rbrack token'>]</span>
    <span class='rubyid_@ssh_opts ivar id'>@ssh_opts</span><span class='lbrack token'>[</span><span class='symbol val'>:keys</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_@config ivar id'>@config</span><span class='lbrack token'>[</span><span class='symbol val'>:auth</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:keys</span><span class='rbrack token'>]</span>
    <span class='rubyid_@ssh_opts ivar id'>@ssh_opts</span><span class='lbrack token'>[</span><span class='symbol val'>:key_data</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_@config ivar id'>@config</span><span class='lbrack token'>[</span><span class='symbol val'>:auth</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:key_data</span><span class='rbrack token'>]</span>
    <span class='rubyid_@ssh_opts ivar id'>@ssh_opts</span><span class='lbrack token'>[</span><span class='symbol val'>:keys_only</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>
  <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_@config ivar id'>@config</span><span class='lbrack token'>[</span><span class='symbol val'>:auth</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:password</span><span class='rbrack token'>]</span>
    <span class='rubyid_@ssh_opts ivar id'>@ssh_opts</span><span class='lbrack token'>[</span><span class='symbol val'>:password</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_@config ivar id'>@config</span><span class='lbrack token'>[</span><span class='symbol val'>:auth</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:password</span><span class='rbrack token'>]</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>
<div id="method_missing_details" class="method_details_list">
  <h2>Dynamic Method Handling</h2>
  <p class="notice super">
    This class handles dynamic methods through the <tt>method_missing</tt> method
    
      in the class <span class='object_link'><a href="Plugin.html#method_missing-instance_method" title="Cosmic::Plugin#method_missing (method)">Cosmic::Plugin</a></span>
    
  </p>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <span id="config-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="config-instance_method">
  
    - (<tt>Object</tt>) <strong>config</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>The plugin&#39;s configuration</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


38
39
40</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cosmic/ssh.rb', line 38</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_config identifier id'>config</span>
  <span class='rubyid_@config ivar id'>@config</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="download-instance_method">
  
    - <strong>download</strong>(params) { ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Downloads a remote file from a remote host.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The parameters</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <h3>Options Hash (<tt>params</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="name">:host</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>The host to copy the file to</p>
</div>
        </li>
      
        <li>
          <span class="name">:user</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>The user to use for the ssh connection; if not specified
then it will use the username from the credentials if configured,
or the current user</p>
</div>
        </li>
      
        <li>
          <span class="name">:local</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>The local target path for the downloaded file to upload; if not
specified then it will use the remote path for this</p>
</div>
        </li>
      
        <li>
          <span class="name">:remote</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>The remote path to the file to download</p>
</div>
        </li>
      
    </ul>
  

<h3>Yields:</h3>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>An optional block of arity 4 that will be executed whenever a new chunk of data is received;
the arguments are: the chunk, the filename, the number of bytes received so far, the size
of the file</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


129
130
131
132
133
134
135
136
137
138
139
140
141
142
143</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cosmic/ssh.rb', line 129</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_download identifier id'>download</span><span class='lparen token'>(</span><span class='rubyid_params identifier id'>params</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='rubyid_block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='rubyid_host identifier id'>host</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:host</span><span class='rbrack token'>]</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_raise identifier id'>raise</span> <span class='string val'>&quot;No :host argument given&quot;</span>
  <span class='rubyid_user identifier id'>user</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:user</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_@config ivar id'>@config</span><span class='lbrack token'>[</span><span class='symbol val'>:auth</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:username</span><span class='rbrack token'>]</span>
  <span class='rubyid_local identifier id'>local</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:local</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:remote</span><span class='rbrack token'>]</span>
  <span class='rubyid_remote identifier id'>remote</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:remote</span><span class='rbrack token'>]</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_raise identifier id'>raise</span> <span class='string val'>&quot;No :remote argument given&quot;</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_@environment ivar id'>@environment</span><span class='dot token'>.</span><span class='rubyid_in_dry_run_mode identifier id'>in_dry_run_mode</span>
    <span class='rubyid_notify identifier id'>notify</span><span class='lparen token'>(</span><span class='symbol val'>:msg</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;Would download remote file #{remote} as user #{user} from host #{host} to local file #{local}&quot;</span><span class='comma token'>,</span>
           <span class='symbol val'>:tags</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:ssh</span><span class='comma token'>,</span> <span class='symbol val'>:dryrun</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_response identifier id'>response</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
    <span class='rubyid_Net constant id'>Net</span><span class='colon2 op'>::</span><span class='rubyid_SCP constant id'>SCP</span><span class='dot token'>.</span><span class='rubyid_start identifier id'>start</span><span class='lparen token'>(</span><span class='rubyid_host identifier id'>host</span><span class='comma token'>,</span> <span class='rubyid_user identifier id'>user</span><span class='comma token'>,</span> <span class='rubyid_@ssh_opts ivar id'>@ssh_opts</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_scp identifier id'>scp</span><span class='bitor op'>|</span>
      <span class='rubyid_scp identifier id'>scp</span><span class='dot token'>.</span><span class='rubyid_download! fid id'>download!</span><span class='lparen token'>(</span><span class='rubyid_remote identifier id'>remote</span><span class='comma token'>,</span> <span class='rubyid_local identifier id'>local</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='rubyid_block identifier id'>block</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="exec-instance_method">
  
    - (<tt>String</tt>) <strong>exec</strong>(params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Executes a command on a remote host and returns the output (stdin &amp; stderr combined) of the
command.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The parameters</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <h3>Options Hash (<tt>params</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="name">:host</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>The host to connect to</p>
</div>
        </li>
      
        <li>
          <span class="name">:user</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>The user to use for the ssh connection; if not specified
then it will use the username from the credentials if configured,
or the current user</p>
</div>
        </li>
      
        <li>
          <span class="name">:cmd</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>The command to run on the host</p>
</div>
        </li>
      
    </ul>
  

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>All output of the command (stdout and stderr combined)</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


69
70
71
72
73
74
75
76
77
78
79
80
81
82
83</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cosmic/ssh.rb', line 69</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_exec identifier id'>exec</span><span class='lparen token'>(</span><span class='rubyid_params identifier id'>params</span><span class='rparen token'>)</span>
  <span class='rubyid_host identifier id'>host</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:host</span><span class='rbrack token'>]</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_raise identifier id'>raise</span> <span class='string val'>&quot;No :host argument given&quot;</span>
  <span class='rubyid_user identifier id'>user</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:user</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_@config ivar id'>@config</span><span class='lbrack token'>[</span><span class='symbol val'>:auth</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:username</span><span class='rbrack token'>]</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:cmd</span><span class='rbrack token'>]</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_raise identifier id'>raise</span> <span class='string val'>&quot;No :cmd argument given&quot;</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_@environment ivar id'>@environment</span><span class='dot token'>.</span><span class='rubyid_in_dry_run_mode identifier id'>in_dry_run_mode</span>
    <span class='rubyid_notify identifier id'>notify</span><span class='lparen token'>(</span><span class='symbol val'>:msg</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;Would connect as user #{user} to host #{host} and execute command '#{cmd}'&quot;</span><span class='comma token'>,</span>
           <span class='symbol val'>:tags</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:ssh</span><span class='comma token'>,</span> <span class='symbol val'>:dryrun</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_response identifier id'>response</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
    <span class='rubyid_Net constant id'>Net</span><span class='colon2 op'>::</span><span class='rubyid_SSH constant id'>SSH</span><span class='dot token'>.</span><span class='rubyid_start identifier id'>start</span><span class='lparen token'>(</span><span class='rubyid_host identifier id'>host</span><span class='comma token'>,</span> <span class='rubyid_user identifier id'>user</span><span class='comma token'>,</span> <span class='rubyid_@ssh_opts ivar id'>@ssh_opts</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_ssh identifier id'>ssh</span><span class='bitor op'>|</span>
      <span class='rubyid_response identifier id'>response</span> <span class='assign token'>=</span> <span class='rubyid_ssh identifier id'>ssh</span><span class='dot token'>.</span><span class='rubyid_exec! fid id'>exec!</span><span class='lparen token'>(</span><span class='rubyid_cmd identifier id'>cmd</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_response identifier id'>response</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="upload-instance_method">
  
    - <strong>upload</strong>(params) { ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Transfers a local file to a remote host.</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The parameters</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <h3>Options Hash (<tt>params</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="name">:host</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>The host to copy the file to</p>
</div>
        </li>
      
        <li>
          <span class="name">:user</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>The user to use for the ssh connection; if not specified
then it will use the username from the credentials if configured,
or the current user</p>
</div>
        </li>
      
        <li>
          <span class="name">:local</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>The local path to the file to upload</p>
</div>
        </li>
      
        <li>
          <span class="name">:remote</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>The remote path to the file to upload; if not specified then
it will use the local path for this</p>
</div>
        </li>
      
    </ul>
  

<h3>Yields:</h3>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>An optional block of arity 4 that will be executed whenever a new chunk of data is sent;
the arguments are: the chunk, the filename, the number of bytes sent so far, the size
of the file</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


99
100
101
102
103
104
105
106
107
108
109
110
111
112
113</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cosmic/ssh.rb', line 99</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_upload identifier id'>upload</span><span class='lparen token'>(</span><span class='rubyid_params identifier id'>params</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='rubyid_block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='rubyid_host identifier id'>host</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:host</span><span class='rbrack token'>]</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_raise identifier id'>raise</span> <span class='string val'>&quot;No :host argument given&quot;</span>
  <span class='rubyid_user identifier id'>user</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:user</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_@config ivar id'>@config</span><span class='lbrack token'>[</span><span class='symbol val'>:auth</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:username</span><span class='rbrack token'>]</span>
  <span class='rubyid_local identifier id'>local</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:local</span><span class='rbrack token'>]</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_raise identifier id'>raise</span> <span class='string val'>&quot;No :local argument given&quot;</span>
  <span class='rubyid_remote identifier id'>remote</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:remote</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:local</span><span class='rbrack token'>]</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_@environment ivar id'>@environment</span><span class='dot token'>.</span><span class='rubyid_in_dry_run_mode identifier id'>in_dry_run_mode</span>
    <span class='rubyid_notify identifier id'>notify</span><span class='lparen token'>(</span><span class='symbol val'>:msg</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;Would upload local file #{local} as user #{user} to host #{host} at #{remote}&quot;</span><span class='comma token'>,</span>
           <span class='symbol val'>:tags</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:ssh</span><span class='comma token'>,</span> <span class='symbol val'>:dryrun</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_response identifier id'>response</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
    <span class='rubyid_Net constant id'>Net</span><span class='colon2 op'>::</span><span class='rubyid_SCP constant id'>SCP</span><span class='dot token'>.</span><span class='rubyid_start identifier id'>start</span><span class='lparen token'>(</span><span class='rubyid_host identifier id'>host</span><span class='comma token'>,</span> <span class='rubyid_user identifier id'>user</span><span class='comma token'>,</span> <span class='rubyid_@ssh_opts ivar id'>@ssh_opts</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_scp identifier id'>scp</span><span class='bitor op'>|</span>
      <span class='rubyid_scp identifier id'>scp</span><span class='dot token'>.</span><span class='rubyid_upload! fid id'>upload!</span><span class='lparen token'>(</span><span class='rubyid_local identifier id'>local</span><span class='comma token'>,</span> <span class='rubyid_remote identifier id'>remote</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='rubyid_block identifier id'>block</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Tue Jan  3 12:53:41 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.4 (ruby-1.8.7).
</div>

  </body>
</html>